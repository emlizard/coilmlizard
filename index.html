<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mutual Inductance Calculator for Circular Coils</title>
    
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <style>
        .mjx-chtml { color: var(--text-primary); }
        #coilVis, .chart-container { min-height: 400px; position: relative; } /* 3D Î∑∞ÏôÄ Ï∞®Ìä∏ ÎÜíÏù¥ ÌôïÎ≥¥ */
        #coilVis canvas { border-radius: var(--radius); }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-content">
            <h1 class="page-title">Mutual Inductance Calculator</h1>
            <button class="theme-toggle" id="theme-toggle-btn" aria-label="Toggle theme"></button>
        </div>
    </header>

    <main class="container">
        
        <section class="card animate-in">
            <h2 class="card-title"><span class="card-icon">‚öôÔ∏è</span>Coil Parameters & Position</h2>
            <div class="grid grid-3">
                <div class="input-column">
                    <h3>Transmitter (Primary)</h3>
                    <div class="input-group">
                        <label for="rmaxTx" class="input-label">Max Radius <span class="input-unit">(cm)</span></label>
                        <input type="number" id="rmaxTx" value="5" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="nSpiralTx" class="input-label">Spiral Turns N<sub>s</sub></label>
                        <input type="number" id="nSpiralTx" value="5" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="pSpiralTx" class="input-label">Spiral Pitch p<sub>s</sub> <span class="input-unit">(mm)</span></label>
                        <input type="text" id="pSpiralTx" value="2" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="nHelixTx" class="input-label">Helical Turns N<sub>h</sub></label>
                        <input type="number" id="nHelixTx" value="5" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="pHelixTx" class="input-label">Helical Pitch p<sub>h</sub> <span class="input-unit">(mm)</span></label>
                        <input type="text" id="pHelixTx" value="2" class="input-field">
                    </div>
                </div>

                <div class="input-column">
                    <h3>Receiver (Secondary)</h3>
                    <div class="input-group">
                        <label for="rmaxRx" class="input-label">Max Radius <span class="input-unit">(cm)</span></label>
                        <input type="number" id="rmaxRx" value="5" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="nSpiralRx" class="input-label">Spiral Turns N<sub>s</sub></label>
                        <input type="number" id="nSpiralRx" value="5" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="pSpiralRx" class="input-label">Spiral Pitch p<sub>s</sub> <span class="input-unit">(mm)</span></label>
                        <input type="text" id="pSpiralRx" value="2" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="nHelixRx" class="input-label">Helical Turns N<sub>h</sub></label>
                        <input type="number" id="nHelixRx" value="5" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="pHelixRx" class="input-label">Helical Pitch p<sub>h</sub> <span class="input-unit">(mm)</span></label>
                        <input type="text" id="pHelixRx" value="2" class="input-field">
                    </div>
                </div>

                <div class="input-column">
                    <h3>Position & Orientation</h3>
                    <div class="input-group">
                        <label for="xOffset" class="input-label">Offset x <span class="input-unit">(cm)</span></label>
                        <input type="number" id="xOffset" value="0" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="yOffset" class="input-label">Offset y <span class="input-unit">(cm)</span></label>
                        <input type="number" id="yOffset" value="0" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="zOffset" class="input-label">Offset z <span class="input-unit">(cm)</span></label>
                        <input type="number" id="zOffset" value="10" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="theta" class="input-label">Tilt Œ∏ <span class="input-unit">(deg)</span></label>
                        <input type="number" id="theta" value="0" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="phi" class="input-label">Rotation œÜ <span class="input-unit">(deg)</span></label>
                        <input type="number" id="phi" value="0" step="1" class="input-field">
                    </div>
                </div>
            </div>
            <button id="calculateBtn" class="btn btn-full">Calculate Mutual Inductance</button>
            <div id="result" class="result-display" style="margin-top: 1.5rem; text-align: center;">
                </div>
        </section>

        <section class="card animate-in">
            <h2 class="card-title"><span class="card-icon">üßä</span>Coil Visualization</h2>
            <div id="coilVis"></div>
        </section>
        
        <section class="card animate-in">
            <h2 class="card-title"><span class="card-icon">üìà</span>Sweep & Graph</h2>
            <div class="parameter-grid">
                <div class="input-group">
                    <label for="sweepVar" class="input-label">Sweep Variable</label>
                    <select id="sweepVar" class="input-field">
                        <option value="x">x (cm)</option>
                        <option value="y">y (cm)</option>
                        <option value="z" selected>z (cm)</option>
                        <option value="phi">œÜ (deg)</option>
                        <option value="theta">Œ∏ (deg)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="sweepMin" class="input-label">Min Value</label>
                    <input type="number" id="sweepMin" value="0" step="0.1" class="input-field">
                </div>
                <div class="input-group">
                    <label for="sweepMax" class="input-label">Max Value</label>
                    <input type="number" id="sweepMax" value="20" step="0.1" class="input-field">
                </div>
                <div class="input-group">
                    <label for="sweepStep" class="input-label">Step Size</label>
                    <input type="number" id="sweepStep" value="1" step="0.1" class="input-field">
                </div>
            </div>
            <div class="parameter-grid">
                <button id="plotBtn" class="btn">Plot Graph</button>
                <button id="saveDataBtn" class="btn">Save Data</button>
            </div>
            <div id="progress" style="margin-top: 1rem; color: var(--primary);"></div>
            <div class="chart-container">
                <canvas id="sweepChart"></canvas>
            </div>
        </section>

        <section class="formula-section card animate-in">
            <h2 class="card-title">Formulas Used</h2>
            <div class="references info-box">
                <h4>References</h4>
                <p>1. S. Babic, F. Sirois, C. Akyel, C. Girardi, ‚ÄúMutual Inductance Calculation Between Two Circular Loops Using 24-Point Gauss Quadrature,‚Äù IEEE Trans. Magn., 2010.<br>
                2. M. Kacenak, ‚ÄúRomberg Integration Algorithm,‚Äù Technical University of Kosice, 2001.</p>
            </div>
            <div class="formula-content">
                </div>
        </section>

    </main>

    <script src="script.js"></script>
</body>
</html>
