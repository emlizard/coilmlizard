<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mutual Inductance Calculator for Circular Coils</title>
    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <style>
        /* Ï∂îÍ∞Ä Ïä§ÌÉÄÏùº */
        .mjx-chtml { color: var(--text-primary); }
        #coilVis, .chart-container { 
            min-height: 450px; 
            position: relative; 
            background: var(--surface); 
            border-radius: var(--radius);
            padding: 0.5rem;
        }
        #coilVis canvas { border-radius: var(--radius); }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-content">
            <h1 class="page-title">Mutual Inductance Calculator</h1>
        </div>
    </header>

    <main class="container">
        
        <section class="card animate-in">
            <h2 class="card-title"><span class="card-icon">‚öôÔ∏è</span>Coil Parameters & Position</h2>
            <div class="grid grid-3">
                <div>
                    <h3>Transmitter (Primary)</h3>
                    <div class="input-group">
                        <label for="rmaxTx" class="input-label">Max Radius <span class="input-unit">(cm)</span></label>
                        <input type="number" id="rmaxTx" value="5" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="nSpiralTx" class="input-label">Spiral Turns N<sub>s</sub></label>
                        <input type="number" id="nSpiralTx" value="5" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="pSpiralTx" class="input-label">Spiral Pitch p<sub>s</sub> <span class="input-unit">(mm)</span></label>
                        <input type="text" id="pSpiralTx" value="2" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="nHelixTx" class="input-label">Helical Turns N<sub>h</sub></label>
                        <input type="number" id="nHelixTx" value="5" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="pHelixTx" class="input-label">Helical Pitch p<sub>h</sub> <span class="input-unit">(mm)</span></label>
                        <input type="text" id="pHelixTx" value="2" class="input-field">
                    </div>
                </div>

                <div>
                    <h3>Receiver (Secondary)</h3>
                    <div class="input-group">
                        <label for="rmaxRx" class="input-label">Max Radius <span class="input-unit">(cm)</span></label>
                        <input type="number" id="rmaxRx" value="5" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="nSpiralRx" class="input-label">Spiral Turns N<sub>s</sub></label>
                        <input type="number" id="nSpiralRx" value="5" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="pSpiralRx" class="input-label">Spiral Pitch p<sub>s</sub> <span class="input-unit">(mm)</span></label>
                        <input type="text" id="pSpiralRx" value="2" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="nHelixRx" class="input-label">Helical Turns N<sub>h</sub></label>
                        <input type="number" id="nHelixRx" value="5" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="pHelixRx" class="input-label">Helical Pitch p<sub>h</sub> <span class="input-unit">(mm)</span></label>
                        <input type="text" id="pHelixRx" value="2" class="input-field">
                    </div>
                </div>

                <div>
                    <h3>Position & Orientation</h3>
                    <div class="input-group">
                        <label for="xOffset" class="input-label">Offset x <span class="input-unit">(cm)</span></label>
                        <input type="number" id="xOffset" value="0" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="yOffset" class="input-label">Offset y <span class="input-unit">(cm)</span></label>
                        <input type="number" id="yOffset" value="0" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="zOffset" class="input-label">Offset z <span class="input-unit">(cm)</span></label>
                        <input type="number" id="zOffset" value="10" step="0.1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="theta" class="input-label">Tilt Œ∏ <span class="input-unit">(deg)</span></label>
                        <input type="number" id="theta" value="0" step="1" class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="phi" class="input-label">Rotation œÜ <span class="input-unit">(deg)</span></label>
                        <input type="number" id="phi" value="0" step="1" class="input-field">
                    </div>
                </div>
            </div>
            <button id="calculateBtn" class="btn btn-full">Calculate Mutual Inductance</button>
            <div id="result" class="result-display" style="margin-top: 1.5rem; text-align: center; font-size: 1.25rem; font-weight: bold;">
                </div>
        </section>

        <section class="card animate-in">
            <h2 class="card-title"><span class="card-icon">üßä</span>Coil Visualization</h2>
            <div id="coilVis"></div>
        </section>
        
        <section class="card animate-in">
            <h2 class="card-title"><span class="card-icon">üìà</span>Sweep & Graph</h2>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); align-items: end;">
                <div class="input-group">
                    <label for="sweepVar" class="input-label">Sweep Variable</label>
                    <select id="sweepVar" class="input-field">
                        <option value="x">x (cm)</option>
                        <option value="y">y (cm)</option>
                        <option value="z" selected>z (cm)</option>
                        <option value="phi">œÜ (deg)</option>
                        <option value="theta">Œ∏ (deg)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="sweepMin" class="input-label">Min</label>
                    <input type="number" id="sweepMin" value="0" step="0.1" class="input-field">
                </div>
                <div class="input-group">
                    <label for="sweepMax" class="input-label">Max</label>
                    <input type="number" id="sweepMax" value="20" step="0.1" class="input-field">
                </div>
                <div class="input-group">
                    <label for="sweepStep" class="input-label">Step</label>
                    <input type="number" id="sweepStep" value="1" step="0.1" class="input-field">
                </div>
            </div>
            <div class="grid grid-2">
                <button id="plotBtn" class="btn">Plot Graph</button>
                <button id="saveDataBtn" class="btn">Save Data</button>
            </div>
            <div id="progress" style="margin-top: 1rem; color: var(--primary);"></div>
            <div class="chart-container">
                <canvas id="sweepChart"></canvas>
            </div>
        </section>

        <section class="formula-section card animate-in">
             <h2 class="card-title">Formulas Used</h2>
             </section>

    </main>
    <!-- Section: Formulas & References -->
    <div class="formulas">
      <h2>Formulas Used</h2>
      <div class="references">
        References:<br />
        1. S. Babic, F. Sirois, C. Akyel, C. Girardi, ‚ÄúMutual Inductance Calculation Between Two Circular Loops Using 24-Point Gauss Quadrature,‚Äù <em>IEEE Trans. Magn.</em>, 2010.<br />
        2. M. Kacenak, ‚ÄúRomberg Integration Algorithm,‚Äù Technical University of Kosice, 2001.
      </div>

      <h3>Normalized Parameters</h3>
      \[
      \alpha = \frac{R_s}{R_p}, 
      \quad 
      \beta = \frac{x_c}{R_p}, 
      \quad 
      \gamma = \frac{y_c}{R_p}, 
      \quad 
      \delta = \frac{z_c}{R_p}.
      \]

      <h3>Law of Cosines in Integrand</h3>
      \[
      A = 1 + e^2 + g^2 + h^2 + d^2 
      + 2\,h\bigl(p_4 \cos p + p_5 \sin p\bigr),
      \]
      where 
      \[
      e = \beta,\quad 
      g = \gamma,\quad 
      h = \alpha,\quad 
      d = \delta.
      \]

      <h3>Auxiliary Quantities</h3>
      \[
      l = \sqrt{a^2 + c^2}, 
      \quad 
      L = \sqrt{l^2 + b^2}, 
      \]
      \[
      V = \sqrt{
        (e^2 + g^2) 
        + h^2\Bigl((1 - \tfrac{b^2 c^2}{l^2 L^2})\cos^2 p 
        + \tfrac{c^2}{l^2}\sin^2 p 
        + \tfrac{a b c}{l^2 L}\sin(2p)\Bigr) 
        - 2\,\tfrac{h}{lL}(e a b - g l^2)\cos p 
        - 2\,\tfrac{h e c}{l}\sin p 
      }.
      \]

      <h3>Modulus for Elliptic Integrals</h3>
      \[
      m = \frac{4\,V}{\,A + 2\,V\,}, 
      \quad 
      k = \sqrt{m}.
      \]
      
      <h3>Complete Elliptic Integrals</h3>
      \[
      K(m) = \int_0^{\frac{\pi}{2}} \frac{1}{\sqrt{1 - m \sin^2 \phi}}\;d\phi, 
      \quad 
      E(m) = \int_0^{\frac{\pi}{2}} \sqrt{1 - m \sin^2 \phi}\;d\phi.
      \]

      <h3>œà-Function</h3>
      \[
      \Psi(m) = (2 - m)\,K(m) \;-\; 2\,E(m).
      \]

      <h3>Integrand f(p)</h3>
      \[
      f(p) = \bigl(p_1 \cos p + p_2 \sin p + p_3\bigr)\;
      \frac{\Psi(m)}{\,k\,V^{1.5}\,},
      \]
      where 
      \[
      \begin{aligned}
      p_1 &= \frac{g\,c}{l}, 
      &\quad
      p_2 &= -\frac{e\,l^2 + g\,a\,b}{l\,L}, 
      &\quad
      p_3 &= \frac{h\,c}{L}, \\[6pt]
      p_4 &= \frac{g\,l^2 - e\,a\,b - d\,b\,c}{L}, 
      &\quad
      p_5 &= \frac{d\,a - e\,c}{l}.
      \end{aligned}
      \]

      <h3>Romberg Integration (1D)</h3>
      \[
      \begin{aligned}
      &\text{Let } \Delta = 2\pi,\quad 
      \text{nodes } 0,\,\tfrac{2\pi}{2^{N-1}},\,2\tfrac{2\pi}{2^{N-1}},\,\dots,\,2\pi, 
      \\[4pt]
      &T_1 = \Delta\,\frac{f_0 + f_{2^{N-1}}}{2}, 
      \qquad
      T_{i} = \frac{T_{i-1} + \Delta\,\sum (\text{new midpoints})\,f}{2}, 
      \\[4pt]
      &R_{i,k} = \frac{4^k\,R_{i,k-1} \;-\; R_{i-1,k-1}}{4^k - 1}, 
      \quad k=1,\ldots,i-1, 
      \\[4pt]
      &\text{Final: } \int_0^{2\pi} f(p)\,dp \approx R_{N,N-1}.
      \end{aligned}
      \]

      <h3>Mutual Inductance</h3>
      \[
      M 
      = \mu_0\,R_s \times (\text{Romberg integral}) 
      = 4\times 10^{-7}\,R_s \times (\text{Romberg result}),
      \]
      with \(\mu_0 = 4\pi \times 10^{-7}\,\mathrm{H/m}.\)
    </div>
  </div>

    <script src="script.js"></script>
</body>
</html>
